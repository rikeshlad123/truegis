<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Inkmap Headless Print</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      max-width: 800px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 300px;
      font-family: monospace;
    }
    canvas {
      display: block;
      margin-top: 2em;
      max-width: 100%;
      border: 1px solid #ccc;
    }
    button {
      padding: 0.6em 1.2em;
      font-size: 1em;
      margin-top: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>üñ®Ô∏è Inkmap: Headless PDF Generator</h1>
  <p>Paste or edit the spec below and click print:</p>

  <textarea id="spec">
{
  "layers": [
    {
      "type": "raster",
      "url": "https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"
    }
  ],
  "size": [297, 210, "mm"],
  "center": [8.55, 47.37],
  "scale": 10000,
  "dpi": 150,
  "projection": "EPSG:3857"
}
  </textarea>

  <button id="printBtn">üñ®Ô∏è Print to PDF</button>
  <canvas id="outputCanvas" width="800" height="600"></canvas>

  <script type="module">
    import { print } from 'https://cdn.jsdelivr.net/npm/@camptocamp/inkmap@2.3.0/dist/inkmap.mjs';
    import { jsPDF } from 'https://cdn.jsdelivr.net/npm/jspdf/dist/jspdf.es.min.js';

    async function runPrint() {
      try {
        const specText = document.getElementById('spec').value;
        const spec = JSON.parse(specText);
        const { canvas } = await print(spec);

        const ctx = document.getElementById('outputCanvas').getContext('2d');
        ctx.clearRect(0, 0, 800, 600);
        ctx.drawImage(canvas, 0, 0, 800, 600);

        const pdf = new jsPDF({
          orientation: 'landscape',
          unit: 'mm',
          format: 'a4'
        });

        const imgData = canvas.toDataURL('image/png');
        pdf.addImage(imgData, 'PNG', 10, 30, spec.size[0], spec.size[1]);
        pdf.save('inkmap-output.pdf');
      } catch (err) {
        alert("‚ùå Error:\n" + err.message);
        console.error(err);
      }
    }

    document.getElementById('printBtn').addEventListener('click', runPrint);
  </script>
</body>
</html>
